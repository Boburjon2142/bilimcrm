{% extends "crm/base.html" %}
{% load humanize crm_extras %}

{% block title %}Buyurtmalar{% endblock %}

{% block extra_css %}
<style>
  @media (max-width: 768px) {
    .crm-orders table { border:0; }
    .crm-orders thead { display:none; }
    .crm-orders tbody, .crm-orders tr, .crm-orders td { display:block; width:100%; }
    .crm-orders tr { border:1px solid #e6e6e6; border-radius:12px; padding:10px 12px; margin-bottom:12px; background:#fff; }
    .crm-orders td { border:0; padding:6px 0; display:flex; justify-content:space-between; gap:12px; }
    .crm-orders td::before { content: attr(data-label); font-weight:600; color:#64748b; }
  }
</style>
{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
  <h4 class="mb-0">Buyurtmalar</h4>
  <div class="d-flex flex-wrap gap-2">
    <a class="btn btn-sm btn-outline-primary" href="{% url 'crm_export_report_pdf' %}">Hisobot PDF</a>
    <form method="get" class="d-flex gap-2">
      <select name="status" class="form-select form-select-sm">
        <option value="">Barchasi</option>
        {% for value, label in statuses %}
        <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
      <button class="btn btn-sm btn-outline-secondary" type="submit">Filter</button>
    </form>
  </div>
</div>

<div class="card crm-card p-3 crm-orders">
  <table class="table crm-table align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>Mijoz</th>
        <th>Telefon</th>
        <th>Summa</th>
        <th>Kanal</th>
      </tr>
    </thead>
    <tbody>
      {% for order in orders %}
      <tr>
        <td data-label="ID">#{{ order.id }}</td>
        <td data-label="Mijoz">{{ order.full_name }}</td>
        <td data-label="Telefon">{{ order.phone|phone }}</td>
        <td data-label="Summa">{{ order.total_price|floatformat:0|intcomma }}</td>
        <td data-label="Kanal">{{ order.get_order_source_display }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="text-muted">Buyurtmalar yo'q</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}


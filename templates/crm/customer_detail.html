{% extends "crm/base.html" %}
{% load humanize crm_extras %}

{% block title %}Mijoz{% endblock %}

{% block content %}
<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
  <div>
    <h4 class="mb-1">{{ customer.full_name }}</h4>
    <div class="text-muted">{{ customer.phone|phone }}</div>
  </div>
  <div class="crm-pill">Chegirma: {{ customer.discount_percent }}%</div>
  <div class="crm-pill">LTV: {{ customer.total_spent|floatformat:0|intcomma }} so'm</div>
  <div class="crm-pill">Buyurtmalar: {{ customer.orders_count|intcomma }}</div>
</div>

<div class="card crm-card p-3">
  <h6 class="fw-semibold">Buyurtmalar tarixi</h6>
  <table class="table crm-table align-middle">
    <thead>
      <tr>
        <th>ID</th>
        <th>Summa</th>
        <th>Status</th>
        <th>Vaqt</th>
      </tr>
    </thead>
    <tbody>
      {% for order in orders %}
      <tr>
        <td>#{{ order.id }}</td>
        <td>{{ order.total_price|floatformat:0|intcomma }}</td>
        <td>{{ order.get_status_display }}</td>
        <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4" class="text-muted">Buyurtmalar yo'q</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

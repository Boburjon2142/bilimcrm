{% extends "base.html" %}
{% load humanize %}
{% block content %}
<div class="flex items-center gap-2">
  <h1 class="text-xl font-semibold text-slate-900">Qidiruv</h1>
  {% if query %}
  <span class="text-sm text-slate-500">"{{ query }}"</span>
  {% endif %}
</div>

<form method="get" class="mt-4 grid gap-3 rounded-lg border border-slate-100 bg-white p-4 sm:grid-cols-4">
  <div class="sm:col-span-2">
    <label class="text-xs font-semibold text-slate-500">So'rov</label>
    <input type="text" name="q" value="{{ query }}" placeholder="Qidiruv" class="mt-2 w-full rounded-md border border-slate-200 px-3 py-2 text-sm">
  </div>
  <div>
    <label class="text-xs font-semibold text-slate-500">Muallif</label>
    <select name="author" class="mt-2 w-full rounded-md border border-slate-200 px-3 py-2 text-sm">
      <option value="">Barchasi</option>
      {% for author in authors %}
      <option value="{{ author.id }}" {% if author.id|stringformat:'s' == current_author %}selected{% endif %}>{{ author.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label class="text-xs font-semibold text-slate-500">Kategoriya</label>
    <select name="category" class="mt-2 w-full rounded-md border border-slate-200 px-3 py-2 text-sm">
      <option value="">Barchasi</option>
      {% for cat in categories %}
      <option value="{{ cat.slug }}" {% if cat.slug == current_category %}selected{% endif %}>{{ cat.name }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label class="text-xs font-semibold text-slate-500">Saralash</label>
    <select name="sort" class="mt-2 w-full rounded-md border border-slate-200 px-3 py-2 text-sm">
      {% for key,label in sort_options %}
      <option value="{{ key }}" {% if current_sort == key %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
  <div>
    <label class="text-xs font-semibold text-slate-500">Limit</label>
    <select name="limit" class="mt-2 w-full rounded-md border border-slate-200 px-3 py-2 text-sm">
      <option value="">Barchasi</option>
      {% for opt in limit_options %}
      <option value="{{ opt }}" {% if current_limit == opt %}selected{% endif %}>{{ opt }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="sm:col-span-4 flex flex-wrap gap-3">
    <button class="rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white hover:bg-blue-700" type="submit">Qidirish</button>
    <a href="{% url 'search' %}" class="rounded-full border border-slate-200 px-5 py-2 text-sm font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600">Tozalash</a>
  </div>
</form>

{% if top_categories %}
<div class="mt-6">
  <div class="text-xs font-semibold uppercase tracking-wide text-slate-400">Eng ko'p qidirilgan</div>
  <div class="mt-3 flex flex-wrap gap-2">
    {% for cat in top_categories %}
    <a class="rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600" href="{% url 'category_detail' cat.slug %}">{{ cat.name }}</a>
    {% endfor %}
  </div>
</div>
{% endif %}

<div class="mt-6 grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4">
  {% for book in books %}
    {% include "partials/product_card.html" with book=book %}
  {% empty %}
  <p class="text-sm text-slate-500">Hech narsa topilmadi.</p>
  {% endfor %}
</div>
{% endblock %}

{% extends "base.html" %}
{% load humanize %}
{% block content %}
<div class="flex items-center justify-between">
  <h1 class="text-xl font-semibold text-slate-900">Sevimlilar</h1>
  {% with fav_count=request.session.favorites|length %}
  {% if fav_count %}
  <span class="rounded-full bg-blue-50 px-3 py-1 text-xs font-semibold text-blue-600">{{ fav_count }}</span>
  {% endif %}
  {% endwith %}
</div>

{% if books %}
<div class="mt-6 grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4">
  {% for book in books %}
  <div class="flex h-full flex-col rounded-lg border border-slate-100 p-3">
    <a href="{{ book.get_absolute_url }}" class="overflow-hidden rounded-md bg-slate-50">
      {% if book.cover_image %}
      <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" loading="lazy" width="240" height="360" class="aspect-[2/3] w-full object-cover">
      {% else %}
      <img src="https://via.placeholder.com/240x360?text=Rasm+yo%27q" alt="{{ book.title }}" loading="lazy" width="240" height="360" class="aspect-[2/3] w-full object-cover">
      {% endif %}
    </a>
    <div class="mt-3 flex flex-1 flex-col">
      <a href="{{ book.get_absolute_url }}" class="line-clamp-2 text-sm font-semibold text-slate-900">{{ book.title }}</a>
      <span class="mt-1 text-xs text-slate-500">{{ book.author.name }}</span>
      <span class="mt-2 text-sm font-semibold text-blue-600">{{ book.sale_price|floatformat:0|intcomma }} so'm</span>
      <div class="mt-3 flex flex-wrap gap-2">
        <form method="post" action="{% url 'add_to_cart' book.id %}">
          {% csrf_token %}
          <input type="hidden" name="quantity" value="1">
          <button class="rounded-full border border-blue-600 px-3 py-1 text-xs font-semibold text-blue-600 hover:bg-blue-50" type="submit">Savatga</button>
        </form>
        <form method="post" action="{% url 'remove_favorite' book.id %}">
          {% csrf_token %}
          <button class="rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600" type="submit">O'chirish</button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="mt-6 rounded-lg border border-dashed border-slate-200 p-6 text-center">
  <p class="text-sm text-slate-500">Sevimli kitoblar hozircha yo'q.</p>
  <a href="{% url 'home' %}" class="mt-3 inline-flex rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white hover:bg-blue-700">Kitoblarni ko'rish</a>
</div>
{% endif %}
{% endblock %}

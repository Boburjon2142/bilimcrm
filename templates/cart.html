{% extends "base.html" %}
{% load humanize %}
{% block content %}
<h1 class="text-xl font-semibold text-slate-900">Savat</h1>

{% if cart_items %}
<div class="mt-6 space-y-4">
  {% for item in cart_items %}
  <div class="flex flex-wrap items-center gap-4 rounded-lg border border-slate-100 p-4">
    <div class="h-24 w-16 overflow-hidden rounded-md bg-slate-50">
      {% if item.book.cover_image %}
      <img src="{{ item.book.cover_image.url }}" alt="{{ item.book.title }}" loading="lazy" width="80" height="120" class="h-full w-full object-cover">
      {% else %}
      <img src="https://via.placeholder.com/80x120?text=Rasm+yo%27q" alt="{{ item.book.title }}" loading="lazy" width="80" height="120" class="h-full w-full object-cover">
      {% endif %}
    </div>
    <div class="flex-1">
      <div class="text-sm font-semibold text-slate-900">{{ item.book.title }}</div>
      <div class="text-xs text-slate-500">{{ item.book.author.name }}</div>
      <div class="mt-2 text-sm font-semibold text-blue-600">{{ item.price|floatformat:0|intcomma }} so'm</div>
    </div>
    <div class="flex items-center gap-2">
      <form method="post" action="{% url 'update_cart' item.book.id %}">
        {% csrf_token %}
        <input type="number" name="quantity" value="{{ item.quantity }}" min="1" class="w-20 rounded-md border border-slate-200 px-2 py-1 text-center text-sm" onchange="this.form.submit()">
      </form>
      <form method="post" action="{% url 'remove_from_cart' item.book.id %}">
        {% csrf_token %}
        <button class="rounded-full border border-slate-200 px-3 py-1 text-xs font-semibold text-slate-600 hover:border-blue-200 hover:text-blue-600" type="submit">O'chirish</button>
      </form>
    </div>
    <div class="ml-auto text-sm font-semibold text-slate-900">{{ item.line_total|floatformat:0|intcomma }} so'm</div>
  </div>
  {% endfor %}
</div>

<div class="mt-6 flex items-center justify-between rounded-lg border border-slate-100 p-4">
  <div class="text-sm font-semibold text-slate-900">Jami: {{ cart_total|floatformat:0|intcomma }} so'm</div>
  <a href="{% url 'checkout' %}" class="rounded-full bg-blue-600 px-5 py-2 text-sm font-semibold text-white hover:bg-blue-700">Buyurtma berish</a>
</div>
{% else %}
<p class="mt-4 text-sm text-slate-500">Savat bo'sh.</p>
{% endif %}
{% endblock %}
